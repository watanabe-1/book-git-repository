<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.watanabe.app.study.mapper.CategoryMapper">
	<select id="findAll"
		resultType="org.watanabe.app.study.entity.Category">
		select CAT_CODE, CAT_NAME, CAT_TYPE, NOTE, IMG_TYPE, IMG_ID, ACTIVE,
		INS_DATE, INS_USER, UPD_DATE, UPD_USER from CATEGORY
	</select>
	<select id="findOne"
		resultType="org.watanabe.app.study.entity.Category">
		select CAT_CODE, CAT_NAME, CAT_TYPE, NOTE, IMG_TYPE, IMG_ID, ACTIVE,
		INS_DATE, INS_USER, UPD_DATE, UPD_USER from CATEGORY where CAT_CODE =
		#{catCode}
	</select>
	<insert id="save">
		insert into CATEGORY (CAT_CODE, CAT_NAME, CAT_TYPE, NOTE, IMG_TYPE, IMG_ID,
		ACTIVE, INS_DATE, INS_USER, UPD_DATE, UPD_USER)
		values (#{catCode}, #{catName}, #{catType}, #{note}, #{imgType}, #{imgId},
		#{active}, #{insDate}, #{insUser}, #{updDate}, #{updUser})
	</insert>
	<update id="update">
		update CATEGORY set CAT_CODE = #{catCode}, CAT_NAME = #{catName}, CAT_TYPE =
		#{catType}, NOTE = #{note}, IMG_TYPE = #{imgType}, IMG_ID = #{imgId},
		ACTIVE = #{active}, INS_DATE = #{insDate}, INS_USER = #{insUser},
		UPD_DATE = #{updDate}, UPD_USER = #{updUser} where CAT_CODE =
		#{catCode}
	</update>
	<delete id="delete">
		delete from CATEGORY where CAT_CODE = #{catCode}
	</delete>
	<select id="findAllJoinImage" resultMap="categoryMap">
		select
			C.CAT_CODE
			, C.CAT_NAME
			, C.CAT_TYPE
			, C.NOTE
			, C.IMG_TYPE
			, C.IMG_ID
			, I.IMG_PATH
			, I.IMG_NAME
			, C.ACTIVE
			, C.INS_DATE
			, C.INS_USER
			, C.UPD_DATE
			, C.UPD_USER
		from
			CATEGORY C
				left outer join IMAGE I
					on C.IMG_ID = I.IMG_ID
		order by
			CAT_CODE
	</select>

	<!-- テーブルのSELECT結果をどのようにマッピングするか指定 -->
	<resultMap id="categoryMap"
		type="org.watanabe.app.study.entity.Category">
		<id property="catCode" column="CAT_CODE" />
		<result property="catName" column="CAT_NAME" />
		<result property="catType" column="CAT_TYPE" />
		<result property="note" column="NOTE" />
		<result property="imgType" column="IMG_TYPE" />
		<result property="active" column="ACTIVE" />
		<result property="insDate" column="INS_DATE" />
		<result property="insUser" column="INS_USER" />
		<result property="updDate" column="UPD_DATE" />
		<result property="updUser" column="UPD_USER" />
		<association property="imgIds" resultMap="detailResult" />
	</resultMap>

	<resultMap id="detailResult"
		type="org.watanabe.app.study.entity.Image">
		<result property="imgId" column="IMG_ID" />
		<result property="imgPath" column="IMG_PATH" />
		<result property="imgName" column="IMG_NAME" />
	</resultMap>

</mapper>
